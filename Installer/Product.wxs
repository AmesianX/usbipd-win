<?xml version="1.0" encoding="UTF-8"?>
<!--
    usbipd-win
    Copyright (C) 2020  Frans van Dorsselaer

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.
-->
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
    <Product
        Id="*"
        Name="usbipd-win"
        Language="1033"
        Version="$(var.GitVersion_MajorMinorPatch)"
        Manufacturer="Frans van Dorsselaer"
        UpgradeCode="{EA1D5623-E6A7-4E4A-9259-E3972226646F}"
        >
        <Package InstallerVersion="500" Compressed="yes" InstallScope="perMachine" />

        <?ifdef Debug ?>
            <MediaTemplate EmbedCab="yes" CompressionLevel="none" />
        <?else?>
            <MediaTemplate EmbedCab="yes" CompressionLevel="high" />
        <?endif?>

        <MajorUpgrade
            Schedule="afterInstallExecute"
            AllowSameVersionUpgrades="yes"
            DowngradeErrorMessage="A newer version of [ProductName] is already installed."
            />

        <Property Id="ARPURLINFOABOUT">https://github.com/dorssel/usbipd-win</Property>
        <Property Id="ARPURLUPDATEINFO">https://github.com/dorssel/usbipd-win/releases</Property>
        <Property Id="ARPHELPLINK">https://github.com/dorssel/usbipd-win/issues</Property>
        
        <Feature
            Id="Server"
            Level="1"
            AllowAdvertise="no"
            Display="expand"
            Absent="disallow"
            Title="Server"
            Description="The user mode server application, installed as a service."
            >
            <ComponentGroupRef Id="UsbIpServer" />
            <ComponentRef Id="UsbIpServer.exe" />
            <Feature
                Id="Drivers"
                Level="1"
                AllowAdvertise="no"
                Title="Drivers"
                Description="The VirtualBox USB drivers."
                >
                <ComponentGroupRef Id="Drivers" />
            </Feature>
        </Feature>

        <UIRef Id="UserInterface"/>
    </Product>

    <Fragment>
        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="ProgramFiles64Folder">
                <Directory Id="APPLICATIONFOLDER" Name="usbipd-win" FileSource="$(var.PublishDir)" />
            </Directory>
        </Directory>
    </Fragment>
</Wix>
